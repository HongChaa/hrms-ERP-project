<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hrms.project4th.mvc.repository.MailMapper">

    <insert id="sendRequest">
        INSERT INTO hr_email
        (mail_to,mail_from,mail_title,mail_content)
        VALUES
        (#{mailTo},#{mailFrom},#{mailTitle},#{mailContent})
    </insert>

<!--    접속한 사용자의 사원번호에맞는 메일만 나온다-->
    <select id="getMailList" resultType="MailResponseDTO">
        SELECT
        E.mail_no,
        P.emp_email,
        P.emp_name,
        P.role_code,
        P.dept_code,
        E.mail_title,
        E.mail_status,
        E.mail_date
        FROM HR_EMAIL AS E
        JOIN HR_EMPLOYEES AS P
        <if test="s.mailType == 'mailto'">
            ON E.MAIL_TO = P.EMP_NO
            WHERE E.mail_to = #{empNo}
        </if>
        <if test="s.mailType == 'mailfrom'">
            ON E.MAIL_FROM = P.EMP_NO
            WHERE E.mail_from = #{empNo}
        </if>

        ORDER BY
        E.mail_no DESC
    </select>
<!--접속한 사용자의 번호에맞는 상태값에 따라 메일리스트가 나온다-->
    <select id="getMailListByStatus" resultType="MailResponseDTO">
        SELECT
        E.mail_no,
        P.emp_email,
        P.emp_name,
        P.role_code,
        P.dept_code,
        E.mail_title,
        E.mail_status,
        E.mail_date
        FROM HR_EMAIL AS E
        JOIN HR_EMPLOYEES AS P
        ON E.MAIL_TO = P.EMP_NO
        <choose>
            <when test="status == 'Y'">
                WHERE E.mail_to = #{empNo} AND E.MAIL_STATUS = 'Y'
            </when>
            <when test="status == 'N'">
                WHERE E.mail_to = #{empNo} AND E.MAIL_STATUS = 'N'
            </when>
            <otherwise>
                WHERE E.mail_to = #{empNo}
            </otherwise>
        </choose>
        ORDER BY
        E.mail_no desc
    </select>

    <!--메일번호에 맞는 메일의 객체정보전체가 나온다    -->
    <select id="getMailDetail" resultType="mail">
        SELECT *
        FROM hr_email
        WHERE mail_no = #{mailNo}
    </select>
    
    <update id="mailViewUpdate">
        UPDATE hr_email
        SET mail_status = 'Y'
        WHERE mail_no = #{mailNo};
    </update>



</mapper>